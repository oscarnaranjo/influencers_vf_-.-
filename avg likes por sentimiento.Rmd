---
title: "Promedio likes por sentimiento"
author: "Oscar Naranjo"
date: "27/3/2020"
output: html_document
---

# **1.Creo likes, que permite acceder a data filtrada por sentimiento y agrupada por palabra y linea **
```{r}
likes<-sentimiento%>%
     inner_join(NRC_es, by=c("word"="word"))%>%
     filter(!grepl("positivo|negativo", sentiment))%>%
     group_by(sentiment, word, Likes, Usuario, linea)%>%
     summarize(caption= str_c(word, collapse = " "))%>%
     ungroup()  
```

# **2.Filtro likes por sentimiento (en este caso alegría) y aplico distinct para solo guardar una linea por caption, de esta forma no duplicare los likes por caption, por lo tanto puede analizar likes por caption por sentimiento de forma exacta**    
     
```{r}
filter_alegria_ena<-likes%>%
    select(Usuario, Likes, linea, caption, sentiment) %>%   
    filter(str_detect(sentiment, "alegria"))%>%
    distinct(linea, .keep_all = TRUE)
```

# **3.Crear diccionario de stopwords**
## *solo uso "likes por que es la palabra que quiero quitar*

```{r}
stop_likes<-c("likes",",")
```

# **4.Creo stop_t_likes** 
## *para que pueda usarlo en antijoin*

```{r}
stop_t_likes<-as_tibble(stop_likes) 
```

# **5.Elimino la palabra Likes y filtro por usuario**
## *5.a.separo la data en tokens pero al mismo tiempo señalo en lineas = row_number para que la linea a la que corresponda a cada palabra quede señalada.*

## *5.b.para función unnest_token si pongo: token = "ngrams", n = # me permite crear ngram*

## *5.c.crear un vector para que se almacene el resultado y despues poder trabajar con el para volver a unirlo*

## *5.d.Aplico antijoin con stop para borrar Likes*

## *5.e.Aplico rename para cambiar el nombre de las columnas*

## *5.f.Aplico filter(str_detect()) para filtrar por usuario*

## *TIP: si deseo quitar una columna, aplico select EJ: select(-linea)*

#*alegria ena*
```{r}
ftr_alegria_ena<-filter_alegria%>%
  mutate(linea= row_number()) %>%
  ungroup() %>%
  unnest_tokens(token, Likes)%>%
  anti_join(stop_t_likes, by=c("token"="value"))%>%
  rename(usuario=Usuario, likes=token)%>%
  filter(str_detect(usuario, "enahernandezh"))
```

##*transformo la data de la columna likes a numeros* 
```{r}
ftr_alegria_ena$likes<-as.numeric(gsub(",","",ftr_alegria_ena$likes))
```

##*construyo tabla con el average de likes de cada sentimiento*
```{r}
avg_alg_ena<-ftr_alegria_ena%>%
    summarise(sd_likes=sd(likes), avg_likes=mean(likes))%>%
  add_column(sentimiento="alegria")%>%
  add_column(seguidores=61100)%>%
  add_column(tasa_like="")%>%
  add_column(usuario="ena")
```

##*agrego valor a tasa_like
```{r}
avg_alg_ena$tasa_like<-avg_alg_ena$seguidores/avg_alg_ena$avg_likes
```


#*alegria aethos*
```{r}
ftr_alegria_aethos<-filter_alegria%>%
  mutate(linea= row_number()) %>%
  ungroup() %>%
  unnest_tokens(token, Likes)%>%
  anti_join(stop_t_likes, by=c("token"="value"))%>%
  rename(usuario=Usuario, likes=token)%>%
  filter(str_detect(usuario, "aethosheadcoach"))
```

##*transformo la data de la columna likes a numeros* 
```{r}
ftr_alegria_aethos$likes<-as.numeric(gsub(",","",ftr_alegria_aethos$likes))
```

##*construyo tabla con el average de likes de cada sentimiento*
```{r}
avg_alg_aethos<-ftr_alegria_aethos%>%
    summarise(sd_likes=sd(likes), avg_likes=mean(likes))%>%
  add_column(sentimiento="alegria")%>%
  add_column(seguidores=15300)%>%
  add_column(tasa_like="")%>%
  add_column(usuario="aethos")
```


##*agrego valor a tasa_like
```{r}
avg_alg_aethos$tasa_like<-avg_alg_aethos$seguidores/avg_alg_aethos$avg_likes
```


#*anticipación*
```{r}
ftr_anticipacion_clean<-filter_anticipacion%>%
  mutate(linea= row_number()) %>%
  ungroup() %>%
  unnest_tokens(token, Likes)%>%
  anti_join(stop_t_likes, by=c("token"="value"))%>%
  rename(usuario=Usuario, likes=token)%>%
  select(-linea)
```

```{r}
ftr_anticipacion_clean$likes<-as.numeric(gsub(",","",ftr_anticipacion_clean$likes))
```

```{r}
avg_ftr_anticipacion<-ftr_anticipacion_clean%>%
    summarise(likes=mean(likes))%>%
  add_column(sentimiento="anticipación")
```

#*confianza*
```{r}
ftr_confianza_clean<-filter_confianza%>%
  mutate(linea= row_number()) %>%
  ungroup() %>%
  unnest_tokens(token, Likes)%>%
  anti_join(stop_t_likes, by=c("token"="value"))%>%
  rename(usuario=Usuario, likes=token)%>%
  select(-linea)
```

```{r}
ftr_confianza_clean$likes<-as.numeric(gsub(",","",ftr_confianza_clean$likes))
```

```{r}
avg_ftr_confianza<-ftr_confianza_clean%>%
    summarise(likes=mean(likes))%>%
  add_column(sentimiento="confianza")
```

#*disgusto*
```{r}
ftr_disgusto_clean<-filter_disgusto%>%
  mutate(linea= row_number()) %>%
  ungroup() %>%
  unnest_tokens(token, Likes)%>%
  anti_join(stop_t_likes, by=c("token"="value"))%>%
  rename(usuario=Usuario, likes=token)%>%
  select(-linea)
```

```{r}
ftr_disgusto_clean$likes<-as.numeric(gsub(",","",ftr_disgusto_clean$likes))
```

```{r}
avg_ftr_disgusto<-ftr_disgusto_clean%>%
    summarise(likes=mean(likes))%>%
  add_column(sentimiento="disgusto")
```

#*enfado*
```{r}
ftr_enfado_clean<-filter_enfado%>%
  mutate(linea= row_number()) %>%
  ungroup() %>%
  unnest_tokens(token, Likes)%>%
  anti_join(stop_t_likes, by=c("token"="value"))%>%
  rename(usuario=Usuario, likes=token)%>%
  select(-linea)
```

```{r}
ftr_enfado_clean$likes<-as.numeric(gsub(",","",ftr_enfado_clean$likes))
```

```{r}
avg_ftr_enfado<-ftr_enfado_clean%>%
    summarise(likes=mean(likes))%>%
  add_column(sentimiento="enfado")
```

#*miedo*
```{r}
ftr_miedo_clean<-filter_miedo%>%
  mutate(linea= row_number()) %>%
  ungroup() %>%
  unnest_tokens(token, Likes)%>%
  anti_join(stop_t_likes, by=c("token"="value"))%>%
  rename(usuario=Usuario, likes=token)%>%
  select(-linea)
```

```{r}
ftr_miedo_clean$likes<-as.numeric(gsub(",","",ftr_miedo_clean$likes))
```

```{r}
avg_ftr_miedo<-ftr_miedo_clean%>%
    summarise(likes=mean(likes))%>%
  add_column(sentimiento="miedo")
```

#*sorpresa*
```{r}
ftr_sorpresa_clean<-filter_sorpresa%>%
  mutate(linea= row_number()) %>%
  ungroup() %>%
  unnest_tokens(token, Likes)%>%
  anti_join(stop_t_likes, by=c("token"="value"))%>%
  rename(usuario=Usuario, likes=token)%>%
  select(-linea)
```

```{r}
ftr_sorpresa_clean$likes<-as.numeric(gsub(",","",ftr_sorpresa_clean$likes))
```

```{r}
avg_ftr_sorpresa<-ftr_sorpresa_clean%>%
    summarise(likes=mean(likes))%>%
  add_column(sentimiento="sorpresa")
```

#*tristeza*
```{r}
ftr_tristeza_clean<-filter_tristeza%>%
  mutate(linea= row_number()) %>%
  ungroup() %>%
  unnest_tokens(token, Likes)%>%
  anti_join(stop_t_likes, by=c("token"="value"))%>%
  rename(usuario=Usuario, likes=token)%>%
  select(-linea)
```

```{r}
ftr_tristeza_clean$likes<-as.numeric(gsub(",","",ftr_tristeza_clean$likes))
```

```{r}
avg_ftr_tristeza<-ftr_tristeza_clean%>%
    summarise(likes=mean(likes))%>%
  add_column(sentimiento="tristeza")
```

# **4.Uno las tablas de average de promedio de cada sentimiento**
## *para generar una sola tabla*


```{r}
avg_full<-avg_ftr_alegria%>%
  full_join(avg_ftr_anticipacion)%>%
  full_join(avg_ftr_confianza)%>%
  full_join(avg_ftr_disgusto)%>%
  full_join(avg_ftr_enfado)%>%
  full_join(avg_ftr_miedo)%>%
  full_join(avg_ftr_sorpresa)%>%
  full_join(avg_ftr_tristeza)
```


#**5.para graficar avg_full**
*debo indicar en aes, fill=usuario, para que llene de colores según usuario, además en scale_fill_manual indico values, para indicar color
```{r}
ggplot(avg_full, aes(reorder(x=usuario,tasa_like), y=tasa_like, fill =usuario))+
    geom_col()+
    theme(axis.text.x=element_text(angle=90, vjust = -0,1))+
    scale_fill_manual(name="frecuencia", values = c("skyblue", "royalblue"))+
    labs(x="Usuario", title="Tasa likes - Alegría")
```




##*tambien puede ser*

```{r}
barplot(height=sort(avg_full$likes, decreasing = TRUE),names=sort(avg_full$sentimiento, decreasing= TRUE), las=2, ylim=c(0, 2500), main ="likes por sentimiento para la palabra más repetida", col="grey", ylab="total de likes")
```



# **5.Función summary para ver el resumen estadistico**
```{r}
summary(ftr_alegria_clean$likes)
```

# **Tip: para ver la distribución aplicar funcion hist(x)** o **qqnorm(x)** o **boxplot(x)**
# **TIP2: qqline(x) para trazar una linea entre primer y tercer cuartil, para juzgar lo goodness of fit del qq plot**

# **6.Para exportar la data a excel, aplico**
##*write_xlsx(ftr_alegria_clean, ftr_alegria_clean.xlsx)*
###*antes debo instalar y cargar a libreria*
install.packages("writexl")
library("writexl")

ff
